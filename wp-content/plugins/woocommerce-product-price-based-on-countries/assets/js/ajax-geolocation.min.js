!function(o){if("undefined"==typeof wc_price_based_country_ajax_geo_params)return;var s={xhr:!1,get_product_ids:function(){var a=[],r=null;return o("span.wcpbc-price.loading").each(function(){if(void 0===(r=o(this).data("productId"))){var e=o(this).attr("class").match(/wcpbc-price-\d+/);null!=e&&0<e.length&&(r=parseInt(e[0].replace("wcpbc-price-","")))}r&&void 0!==r&&a.push(r)}),0<o(".variations_form").length&&o(".variations_form").each(function(){var e=o(this).data("product_variations");null!=e&&o.each(e,function(e,r){void 0!==r.variation_id&&a.push(r.variation_id)})}),o(document.body).trigger("wc_price_based_country_get_product_ids",[a]),a.sort(),a},get_areas:function(){var t={};return o(".wc-price-based-country-refresh-area:not(.refreshed)").each(function(e,r){var a=o(r).data("area"),c=o(r).data("id"),i=o(r).data("options");void 0!==a&&void 0!==c&&void 0!==i&&(void 0===t[a]&&(t[a]={}),t[a][c]=i)}),t},refresh_product_price:function(t){var a;o.each(t,function(e,r){void 0!==(a=o("<div>"+r.price_html+"</div>").find(".wcpbc-price.wcpbc-price-"+r.id+":first"))&&o(".wcpbc-price.wcpbc-price-"+r.id).html(a.html()).removeClass("loading")}),0<o(".variations_form").length&&o(".variations_form").each(function(){var c=o(this).data("product_variations"),i=o(this);null!=c&&(o.each(c,function(e,r){if(void 0!==t[r.variation_id]){var a=o(r.price_html);c[e].display_price=t[r.variation_id].display_price,c[e].display_regular_price=t[r.variation_id].display_regular_price,0<a.length?a.hasClass("price")?a.first().html(t[r.variation_id].price_html):a=o(t[r.variation_id].price_html):o("body").hasClass("single-product")||(a=s.compatibility.variation_price_html(a,i,t[r.variation_id].price_html)),0<a.length&&(a.find(".wcpbc-price").css("visibility",""),a.find(".wcpbc-price").removeClass("loading"),a=o("<div></div>").append(a),c[e].price_html=a.html())}}),o(this).data("product_variations",c))}),o(document.body).trigger("wc_price_based_country_set_product_price",[t]),o(".wcpbc-price").css("visibility",""),o(".wcpbc-price").css("display",""),o(".wcpbc-price").removeClass("loading")},refresh_areas:function(e){o.each(e,function(e,r){var a='.wc-price-based-country-refresh-area[data-id="'+r.id+'"][data-area="'+r.area+'"]',c=o("<div>"+r.content+"</div>").find('.wc-price-based-country-refresh-area[data-area="'+r.area+'"]').html();o(a).html(c).addClass("refreshed")}),o(document.body).trigger("wc_price_based_country_refresh_areas",[e])},refresh_currency_settings:function(e){if("undefined"!=typeof woocommerce_price_slider_params&&"undefined"!=typeof accounting){var r=o(".price_slider_amount #min_price").data("min"),a=o(".price_slider_amount #max_price").data("max");o(".price_slider_amount span.from").html(accounting.formatMoney(r,{symbol:e.symbol,decimal:e.decimal_sep,thousand:e.thousand_sep,precision:woocommerce_price_slider_params.currency_format_num_decimals,format:e.format})),o(".price_slider_amount span.to").html(accounting.formatMoney(a,{symbol:e.symbol,decimal:e.decimal_sep,thousand:e.thousand_sep,precision:woocommerce_price_slider_params.currency_format_num_decimals,format:e.format})),woocommerce_price_slider_params.currency_format_symbol=e.symbol,woocommerce_price_slider_params.currency_format_decimal_sep=e.decimal_sep,woocommerce_price_slider_params.currency_format_thousand_sep=e.thousand_sep,woocommerce_price_slider_params.currency_format=e.format}o(document.body).trigger("wc_price_based_country_set_currency_params",[e])},compatibility:{variation_price_html:function(e,r,a){return e.length<=0&&r.hasClass("wvs-archive-variation-wrapper")&&(e=o("<span></span>").append(a)),e},bind:function(){0<o(".shop-container .products").length&&o(".shop-container .products").on("append.infiniteScroll",s.geolocate_customer),0<o(".wc-price-based-country-refresh-area .wcsatt-options-wrapper").length&&(o(".wc-price-based-country-refresh-area .wcsatt-options-wrapper").each(function(){var e=o(this).closest(".wc-price-based-country-refresh-area").data("id");o(this).addClass("wcpbc-refresh-flag wcpbc-refresh-flag-"+e)}),o(document.body).on("wc_price_based_country_refresh_areas",function(){o(".wcsatt-options-wrapper.wcpbc-refresh-flag").length&&o(".wc-price-based-country-refresh-area .wcsatt-options-wrapper").each(function(){var e=o(this).closest(".wc-price-based-country-refresh-area").data("id"),r=o(this).closest(".wc-price-based-country-refresh-area").html();o(".wcsatt-options-wrapper.wcpbc-refresh-flag-"+e).replaceWith(r),o(this).remove()}),o(".product form.cart").each(function(){o(this).data("satt_script",null)}),o(document.body).triggerHandler("wcsatt-initialize")})),0<o(".variations_form.cart").length&&0<o('[class^="wcsatt"]').length&&o(document.body).on("wc_price_based_country_set_product_price",function(){0<o(".variations_form.cart .wcsatt-options-wrapper").length&&o(".variations_form.cart .variations select").trigger("change.wc-variation-form")})}},geolocate_customer:function(){s.xhr&&s.xhr.abort();var e={ids:s.get_product_ids(),areas:s.get_areas(),is_single:o("body").hasClass("single")?"1":"0"};0===e.ids.length&&o.isEmptyObject(e.areas)&&0===o(".wcpbc-content:not(.refreshed)").length||(s.xhr=o.ajax({url:wc_price_based_country_ajax_geo_params.wc_ajax_url.toString().replace("%%endpoint%%","wcpbc_get_location"),data:e,type:"POST",success:function(e){s.refresh_product_price(e.products),s.refresh_areas(e.areas),s.refresh_currency_settings(e.currency_params),o(document.body).trigger("wc_price_based_country_after_ajax_geolocation",[e.zone_id])},error:function(){o(".wcpbc-price").css("visibility",""),o(".wcpbc-price").css("display",""),o(".wcpbc-price").removeClass("loading")},complete:function(){s.xhr=!1}}))},init:function(){this.geolocate_customer(),o(document).ajaxComplete(function(e,r,a){0==o("body").find(".wcpbc-price.loading").length||0<a.url.indexOf("wcpbc_get_location")||0<a.url.indexOf("get_refreshed_fragments")||void 0!==r.responseText&&0<r.responseText.indexOf("wcpbc-price")&&s.geolocate_customer()}),o(document.body).on("wc_price_based_country_ajax_geolocation",s.geolocate_customer),this.compatibility.bind()}};s.init()}(jQuery);